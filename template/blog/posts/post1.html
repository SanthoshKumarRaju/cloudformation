<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS CloudFormation 2-Tier Architecture - Blog Post</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">
    <style>
        .post-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 100px 20px 50px;
        }
        
        .post-header {
            margin-bottom: 40px;
        }
        
        .post-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .post-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            color: var(--gray);
        }
        
        .post-tags {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .tag {
            background: var(--light);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .post-body h2 {
            margin: 40px 0 20px;
            color: var(--dark);
        }
        
        .post-body h3 {
            margin: 30px 0 15px;
            color: var(--primary);
        }
        
        .post-body p {
            margin-bottom: 20px;
            line-height: 1.8;
        }
        
        .post-body ul, .post-body ol {
            margin-left: 20px;
            margin-bottom: 20px;
        }
        
        .post-body li {
            margin-bottom: 10px;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: var(--font-code);
        }
        
        .architecture-image {
            width: 100%;
            max-width: 800px;
            margin: 30px auto;
            display: block;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .back-link {
            display: inline-block;
            margin-top: 40px;
            font-weight: 500;
        }
        
        .resource-box {
            background: var(--light);
            padding: 20px;
            border-radius: 5px;
            margin: 30px 0;
        }
        
        .resource-box h3 {
            margin-top: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: var(--light);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>AWS Architecture Blog</h1>
                <p>Cloud Infrastructure & Deployment</p>
            </div>
            <nav class="navbar">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../index.html#about">About</a></li>
                    <li><a href="../index.html#posts">Posts</a></li>
                    <li><a href="../index.html#contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="post-content">
        <div class="post-header">
            <h1 class="post-title">AWS CloudFormation 2-Tier Architecture</h1>
            <div class="post-meta">
                <span>Published: september 25, 2025</span>
                <span>Author: Santhosh</span>
                <span>Reading Time: 15 min</span>
            </div>
            <div class="post-tags">
                <span class="tag">CloudFormation</span>
                <span class="tag">AWS</span>
                <span class="tag">Infrastructure as Code</span>
                <span class="tag">VPC</span>
                <span class="tag">Auto Scaling</span>
            </div>
        </div>
        
        <div class="post-body">
            <h2>Introduction</h2>
            <p>In this comprehensive guide, we'll walk through the implementation of a production-ready 2-tier web architecture on AWS using CloudFormation. This architecture separates the web tier from the database tier for enhanced security and scalability.</p>
            
            <p>The infrastructure we'll build includes:</p>
            <ul>
                <li>A VPC with public and private subnets across two availability zones</li>
                <li>An Application Load Balancer (ALB) to distribute traffic</li>
                <li>An Auto Scaling Group for the web tier with EC2 instances</li>
                <li>An RDS MySQL database instance in private subnets</li>
                <li>Security groups to control network traffic</li>
                <li>A custom AMI with Apache web server pre-configured</li>
            </ul>
            
            <h2>Architecture Overview</h2>
            <p>The following diagram illustrates our 2-tier architecture:</p>
            
            <div class="architecture-image" style="background: #f5f5f5; height: 400px; display: flex; justify-content: center; align-items: center;">
                <div style="text-align: center;">
                    <p><strong>Architecture Diagram Placeholder</strong></p>
                    <p>Visual representation of VPC, subnets, ALB, EC2 instances, and RDS</p>
                </div>
            </div>
            
            <h2>1. VPC and Network Configuration</h2>
            <p>We start by creating a Virtual Private Cloud (VPC) with CIDR block 10.0.0.0/16. This provides a private network space for our resources.</p>
            
            <h3>Subnet Design</h3>
            <p>Our VPC contains four subnets strategically placed across two availability zones:</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Subnet</th>
                        <th>CIDR Block</th>
                        <th>AZ</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>PublicSubnet1</td>
                        <td>10.0.0.0/24</td>
                        <td>ap-south-1a</td>
                        <td>Public</td>
                    </tr>
                    <tr>
                        <td>PublicSubnet2</td>
                        <td>10.0.1.0/24</td>
                        <td>ap-south-1b</td>
                        <td>Public</td>
                    </tr>
                    <tr>
                        <td>PrivateSubnet1</td>
                        <td>10.0.2.0/24</td>
                        <td>ap-south-1a</td>
                        <td>Private</td>
                    </tr>
                    <tr>
                        <td>PrivateSubnet2</td>
                        <td>10.0.3.0/24</td>
                        <td>ap-south-1b</td>
                        <td>Private</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>Route Tables and Internet Gateway</h3>
            <p>We create an Internet Gateway and attach it to our VPC. Public subnets use a route table that directs internet-bound traffic to the Internet Gateway, while private subnets use a separate route table without internet access.</p>
            
            <div class="code-block">
# Internet Gateway Configuration
InternetGateway:
  Type: AWS::EC2::InternetGateway
  Properties:
    Tags:
      - Key: Name
        Value: 2-tier-igw

VPCGatewayAttachment:
  Type: AWS::EC2::VPCGatewayAttachment
  Properties:
    VpcId: !Ref VPC
    InternetGatewayId: !Ref InternetGateway
            </div>
            
            <h2>2. Security Groups</h2>
            <p>Security groups act as virtual firewalls for our EC2 instances and RDS database. We create three security groups:</p>
            
            <h3>WebServer Security Group</h3>
            <p>Allows HTTP (port 80) and SSH (port 22) traffic from anywhere:</p>
            
            <div class="code-block">
WebServerSG:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: Allow HTTP and SSH
    VpcId: !Ref VPC
    SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 22
        ToPort: 22
        CidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        FromPort: 80
        ToPort: 80
        CidrIp: 0.0.0.0/0
            </div>
            
            <h3>Database Security Group</h3>
            <p>Allows MySQL (port 3306) traffic only from the WebServer security group:</p>
            
            <div class="code-block">
DBSG:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: Allow MySQL from WebServerSG
    VpcId: !Ref VPC
    SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 3306
        ToPort: 3306
        SourceSecurityGroupId: !Ref WebServerSG
            </div>
            
            <h3>ALB Security Group</h3>
            <p>Allows HTTP (port 80) traffic from anywhere for the Application Load Balancer:</p>
            
            <div class="code-block">
ALBSG:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: Allow HTTP from Internet
    VpcId: !Ref VPC
    SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 80
        ToPort: 80
        CidrIp: 0.0.0.0/0
            </div>
            
            <h2>3. RDS MySQL Database</h2>
            <p>We deploy an RDS MySQL instance in the private subnets for enhanced security. The database is not directly accessible from the internet.</p>
            
            <div class="code-block">
DBSubnetGroup:
  Type: AWS::RDS::DBSubnetGroup
  Properties:
    DBSubnetGroupDescription: epicreads
    SubnetIds:
      - !Ref PrivateSubnet1
      - !Ref PrivateSubnet2

MyRDS:
  Type: AWS::RDS::DBInstance
  Properties:
    DBInstanceIdentifier: database-1
    DBInstanceClass: db.t3.micro
    AllocatedStorage: "20"
    Engine: mysql
    MasterUsername: admin
    MasterUserPassword: santhosh
    DBName: stabderd
    DBSubnetGroupName: !Ref DBSubnetGroup
    VPCSecurityGroups:
      - !GetAtt DBSG.GroupId
    PubliclyAccessible: false
            </div>
            
            <h2>4. EC2 Instances and Auto Scaling</h2>
            <p>We create a Launch Template that defines our EC2 instance configuration, including the custom AMI with Apache pre-installed.</p>
            
            <h3>User Data Script</h3>
            <p>The following script installs and configures Apache on our EC2 instances:</p>
            
            <div class="code-block">
#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
            </div>
            
            <h3>Launch Template</h3>
            <p>Our Launch Template references the custom AMI and includes the user data script:</p>
            
            <div class="code-block">
LaunchTemplate:
  Type: AWS::EC2::LaunchTemplate
  Properties:
    LaunchTemplateName: epicbooks
    LaunchTemplateData:
      ImageId: ami-0c7f8a395918fd37f   # Custom AMI
      InstanceType: t2.micro
      KeyName: !Ref KeyName
      SecurityGroupIds:
        - !Ref WebServerSG
      UserData:
        Fn::Base64: !Sub |
          #!/bin/bash
          yum update -y
          systemctl restart httpd || true
            </div>
            
            <h3>Auto Scaling Group</h3>
            <p>The Auto Scaling Group ensures we have the desired number of instances running and can scale based on demand:</p>
            
            <div class="code-block">
AutoScalingGroup:
  Type: AWS::AutoScaling::AutoScalingGroup
  Properties:
    AutoScalingGroupName: epic-reads
    VPCZoneIdentifier:
      - !Ref PublicSubnet1
      - !Ref PublicSubnet2
    MinSize: "1"
    MaxSize: "3"
    DesiredCapacity: "2"
    LaunchTemplate:
      LaunchTemplateId: !Ref LaunchTemplate
      Version: !GetAtt LaunchTemplate.LatestVersionNumber
    TargetGroupARNs:
      - !Ref TargetGroup
            </div>
            
            <h2>5. Application Load Balancer</h2>
            <p>The ALB distributes incoming traffic across our EC2 instances and performs health checks:</p>
            
            <div class="code-block">
ALB:
  Type: AWS::ElasticLoadBalancingV2::LoadBalancer
  Properties:
    Name: epic-reads-alb
    Subnets:
      - !Ref PublicSubnet1
      - !Ref PublicSubnet2
    SecurityGroups:
      - !Ref ALBSG
    Scheme: internet-facing

ALBListener:
  Type: AWS::ElasticLoadBalancingV2::Listener
  Properties:
    LoadBalancerArn: !Ref ALB
    Port: 80
    Protocol: HTTP
    DefaultActions:
      - Type: forward
        TargetGroupArn: !Ref TargetGroup
            </div>
            
            <h2>Deployment Process</h2>
            <p>We deploy our infrastructure in two stages using CloudFormation stacks:</p>
            
            <ol>
                <li><strong>Network Stack:</strong> Creates VPC, subnets, route tables, and security groups</li>
                <li><strong>Compute Stack:</strong> Creates Launch Template, Auto Scaling Group, ALB, and RDS</li>
            </ol>
            
            <h3>Deployment Commands</h3>
            
            <div class="code-block">
# Deploy network stack
aws cloudformation deploy \
  --template-file network-stack.yaml \
  --stack-name network-stack \
  --region ap-south-1

# Deploy compute stack with parameters
aws cloudformation deploy \
  --template-file compute-stack.yaml \
  --stack-name compute-stack \
  --parameter-overrides \
    KeyName=personal-aws \
    VPC=vpc-xxxxxx \
    PublicSubnet1=subnet-xxxxxx \
    PublicSubnet2=subnet-yyyyyy \
    WebServerSG=sg-xxxxxx \
    ALBSG=sg-yyyyyy \
  --region ap-south-1
            </div>
            
            <h2>Testing and Validation</h2>
            <p>After deployment, we validate our architecture:</p>
            
            <ul>
                <li>Access the ALB DNS name in a web browser to verify the Apache default page</li>
                <li>Check that EC2 instances are registered with the target group</li>
                <li>Verify that the RDS instance is running and accessible from EC2 instances</li>
                <li>Test auto scaling by modifying the desired capacity</li>
            </ul>
            
            <h2>Conclusion</h2>
            <p>This CloudFormation template implements a robust 2-tier architecture that follows AWS best practices. The separation of web and database tiers enhances security, while auto scaling ensures our application can handle varying loads efficiently.</p>
            
            <p>This infrastructure can serve as a foundation for various web applications and can be extended with additional services like CloudFront, WAF, or Elasticache based on specific requirements.</p>
            
            <div class="resource-box">
                <h3>Resources</h3>
                <ul>
                    <li><a href="#">Complete CloudFormation Templates</a></li>
                    <li><a href="#">AWS VPC Documentation</a></li>
                    <li><a href="#">Auto Scaling Best Practices</a></li>
                    <li><a href="#">RDS Security Guidelines</a></li>
                </ul>
            </div>
            
            <a href="../index.html" class="back-link">← Back to Home</a>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>AWS Architecture Blog</h3>
                    <p>Documenting cloud infrastructure implementations and best practices.</p>
                </div>
                <div class="footer-section">
                    <h3>Connect</h3>
                    <ul>
                        <li><a href="#">GitHub</a></li>
                        <li><a href="#">LinkedIn</a></li>
                        <li><a href="#">Twitter</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#">AWS Documentation</a></li>
                        <li><a href="#">CloudFormation Guide</a></li>
                        <li><a href="#">Templates Repository</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 SanthoshKumarRaju. All rights reserved.</p>
            </div>
        </div>
    </footer>
</body>
</html>